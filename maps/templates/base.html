
{% load staticfiles %}

<head>
  <title>OpenLayers Example</title>


     <script src="https://unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.js"></script>
    <script
    src="http://dev.openlayers.org/OpenLayers.js"></script>


<script src="http://maps.google.com/maps/api/js?v=3&amp;sensor=false"></script>
    <script src = "http://appliance.example.com/developers/javascript-sdk/2.0.0/openlayers-tools.js"></script>
<script src="http://openlayers.org/en/v3.18.2/build/ol.js"></script>
    <script src="google-v3-alloverlays.js"></script>

    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAINgesJb4VJ2iYHIcc-gT7hQGhS5yCmtMNZMUBKgpbJFW2uH_cRSd35D9AE7VSWY096Cd7dLkCk3bRA" type="text/javascript" encoding="utf-8"></script>
<script src="https://code.jquery.com/jquery-3.1.1.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.12.4.min.js"></script>
              <link rel="stylesheet" media="all" href="{% static "dashboard.css" %}" type="text/css">

    <!-- Custom styles for this template -->
    <link rel="stylesheet" media="all" href="{% static "bootstrap.css" %}" type="text/css">
    <link rel="stylesheet" media="all" href="{% static "main.css" %}" type="text/css">



    </head>
    <body>

       </div>

           <nav class="navbar navbar-dark navbar-fixed-top bg-inverse">
      <button type="button" class="navbar-toggler hidden-sm-up" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href={% url 'home' %}>КАРТА</a>
        <a class="navbar-brand" href={% url 'project' %}>ПРО ПРОЕКТ</a>
        <a class="navbar-brand" href={% url 'help' %}>ДОПОМОГА</a>

      <div id="navbar">
 <div id="navbar">
        <nav class="nav navbar-nav pull-xs-left">



        </nav>
        <form class="pull-xs-right">
          <input type="text" class="form-control" placeholder="Search...">
        </form>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-3 col-md-2 sidebar" id = "list">

            <span class="anchor">Оберіть культуру</span>
          <ul class="nav nav-sidebar">
            <li><input type="checkbox" id = "soya" />Соя</li>
            <li><input type="checkbox" id = "kukuruza"/>Кукурудза</li>
            <li><input type="checkbox" id= "son" />Соняшник </li>
          </ul></br>
            <span class="anchor">Оберіть растр</span>
          <ul class="nav nav-sidebar">

            <li><input type="checkbox" id = 'zvich' checked/>Знімок звичайний</li>
            <li><input type="checkbox" id = "ndvi"/>Знімок NDVI</li>

        </ul></br>
             <span class="anchor">Оберіть карту</span>

          <ul class="nav nav-sidebar">
            <li><input type="checkbox" id="google"/>Гугл карта</li>
            <li><input type="checkbox" id = "sat"/>Супутниковий знімок</li>
            <li><input type="checkbox" id="simple"/>Проста карта</li>
              </ul>
        </div>
<div class="container">
             {% block content %}

       <div id="list" class="dropdown-check-list" tabindex="100">









    </div>






      <div  id="map" class="map">


      <script defer="defer" type="text/javascript">




            var checkList = document.getElementById('list');
        checkList.getElementsByClassName('anchor')[0].onclick = function (evt) {
            if (checkList.classList.contains('visible'))
                checkList.classList.remove('visible');
            else
                checkList.classList.add('visible');

        };

        checkList.onblur = function(evt) {
            checkList.classList.add('visible');
        };
        mapOptions = {projection:"EPSG:900913",displayProjection: new OpenLayers.Projection("EPSG:4326")};
        var vlayer = new OpenLayers.Layer.Vector( "Editable" );
        var map = new OpenLayers.Map('map');

        var baseUrl = window.location.protocol + '//' + window.location.host;

            map.addControl(new OpenLayers.Control.MousePosition() );
vcontrol = new OpenLayers.Control.EditingToolbar(vlayer);
 map.addControl(vcontrol);
var data = NaN;

            var a = function get_popup(lonlat,data){
            popup = new OpenLayers.Popup.FramedCloud("chicken",
                       new OpenLayers.LonLat(lonlat.lon, lonlat.lat),
                        null,
                          data,
                    null,

                       true
            );

             map.addPopup(popup);
                popup.backgroundColor = "#33805c";
             return popup
        };

          OpenLayers.Control.Click = OpenLayers.Class(OpenLayers.Control, {
                defaultHandlerOptions: {

                    'single': true,
                    'double': false,
                    'pixelTolerance': 0,
                    'stopSingle': false,
                    'stopDouble': false
                },

                initialize: function(options) {
                    this.handlerOptions = OpenLayers.Util.extend(
                        {}, this.defaultHandlerOptions
                    );
                    OpenLayers.Control.prototype.initialize.apply(
                        this, arguments
                    );
                    this.handler = new OpenLayers.Handler.Click(
                        this, {
                            'click': this.trigger
                        }, this.handlerOptions
                    );
                },

                trigger: function (e) {
                    var crop, pnt;
                    var lonlat = map.getLonLatFromPixel(e.xy);
                    var pixel = map.getPixelFromLonLat(lonlat);
                    var event = {
                        lonlat: lonlat
                    };
                    var jso = JSON.stringify(event);


                    var result;

                    $.ajax({
                        url: "req/",
                        type: "GET",

                        data: jso,
                        async: false,

                        success: function (response) {

                            $('#mm').html(response);

                        },
                        complete: function (xhr, status) {


                        },
                        error: function (xhr, textStatus, thrownError) {
                            console.log(error);
                        }
                    });


                    a(lonlat, "<div>" + document.getElementById('mm').outerHTML + "</div>");

                }





            });


function add_click(){
    vcontrol.active.deactive();

}
geojson = new OpenLayers.Format.GeoJSON();

            function serialize(){
var str = geojson.write(vlayer.features, true);
            $.ajax({
    url:"statistic/",
    type: "GET",

    data: str,
    async: true,

    success: function(response) {
        $('#statistic').html(response);

  },
    complete:function(xhr, status){
      vcontrol.deactivate();
        vcontrol = new OpenLayers.Control.EditingToolbar(vlayer);
        var click = new OpenLayers.Control.Click();

                map.addControl(click);
                click.activate();
 map.addControl(vcontrol);






    },
    error:function (xhr, textStatus, thrownError){
        console.log(error);
    }
});

            }


           map.addControl(new OpenLayers.Control.ScaleLine());
            var gsat = new OpenLayers.Layer.Google(
        "Google Satellite",
        {type: google.maps.MapTypeId.SATELLITE, numZoomLevels: 22, tiled:true}
    );


 var wms = new OpenLayers.Layer.WMS( "OpenLayers WMS",
  "http://vmap0.tiles.osgeo.org/wms/vmap0",
  {'layers':'basic', 'projection': 'map.displayProjection', tiled: true} );

  tiled = new OpenLayers.Layer.WMS(
                    "pixelsolution:gtif - Tiled", "http://localhost:8080/geoserver/pixelsolution/wms",
                    { transparent: 'true', layers:'pixelsolution:gtif',
        format: "image/png", tiled:true});
	map.addLayers([wms, tiled, vlayer]);





    map.setCenter(new OpenLayers.LonLat(30.59200, 48.46603), 13);

	    var kukuruza = new OpenLayers.Layer.WMS("Кукуруза", "http://localhost:8080/geoserver/pixelsolution/wms",
        { transparent: 'true', layers:'pixelsolution:kukuruza',
        format: "image/png", tiled :true});





	    var soya = new OpenLayers.Layer.WMS("Соя", "http://localhost:8080/geoserver/pixelsolution/wms",
        { transparent: 'true', layers:'pixelsolution:soya',
        format: "image/png", tiled :true});




	    var son = new OpenLayers.Layer.WMS("Соя", "http://localhost:8080/geoserver/pixelsolution/wms",
        { transparent: 'true', layers:'pixelsolution:son',
        format: "image/png", tiled :true});






var check1 = document.querySelector('#kukuruza');
        check1.onclick = function() {
        if (check1.checked) {
         map.addLayer(kukuruza);
        } else {
            map.removeLayer(kukuruza);
         }
        };




        var check2 = document.querySelector('#soya');
        check2.onclick = function() {
        if (check2.checked) {
         map.addLayer(soya);
        } else {
            map.removeLayer(soya);
         }
        } ;


        var check3 = document.querySelector('#son');
        check3.onclick = function() {
        if (check3.checked) {
         map.addLayer(son);
        } else {
            map.removeLayer(son);
         }
        };

        var check4 = document.querySelector('#zvich');
        check4.onclick = function() {
        if (check4.checked) {
         map.addLayer(tiled);
        } else {
            map.removeLayer(tiled);
         }
        };


var click = new OpenLayers.Control.Click();

                map.addControl(click);
                click.activate();

</script>


 {% endblock %}

</div>
<p id = "mm" style="visibility: hidden;">

</p>



</div>
</div>
</div>
       <div>
    <button id = "stat" onclick="serialize()">Порахувати статистику</button>
           <p id = "statistic">
           <p>



           </div>
</body>
</html>

